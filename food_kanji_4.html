<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="È£ü Kanji">
<title>È£ü Food Kanji</title>
<style>
  :root {
    --ink:       #1A1208;
    --paper:     #F7F0E3;
    --lacquer:   #1C0A06;
    --vermilion: #C8372D;
    --gold:      #D4943A;
    --goldlt:    #E8BC6A;
    --cream:     #FAF5EA;
    --muted:     #8A7A62;
    --border:    #3A2820;
    --card-bg:   #241610;
    --surface:   #2E1C12;
    --glow:      rgba(212,148,58,0.15);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    background: var(--lacquer);
    color: var(--cream);
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Subtle noise texture overlay */
  body::before {
    content: '';
    position: fixed; inset: 0; z-index: 0; pointer-events: none;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    opacity: 0.4;
  }

  /* ‚îÄ‚îÄ Pages ‚îÄ‚îÄ */
  .page { display: none; position: relative; z-index: 1; max-width: 420px; margin: 0 auto; padding: 20px 18px 32px; min-height: 100vh; }
  .page.active { display: block; }

  /* ‚îÄ‚îÄ Home ‚îÄ‚îÄ */
  .home-header {
    text-align: center; padding: 36px 0 28px;
  }
  .home-crest {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    font-size: 72px; line-height: 1;
    color: var(--gold);
    text-shadow: 0 0 40px rgba(212,148,58,0.4);
    display: block; margin-bottom: 10px;
  }
  .home-title {
    font-family: 'Hiragino Mincho ProN', 'Yu Mincho', 'Georgia', serif;
    font-size: 1.5rem; font-weight: 600;
    color: var(--cream); letter-spacing: .12em;
  }
  .home-sub {
    font-size: 0.68rem; color: var(--muted); margin-top: 6px;
    letter-spacing: .18em; text-transform: uppercase;
  }

  /* Decorative divider */
  .divider {
    display: flex; align-items: center; gap: 12px;
    margin: 20px 0;
    color: var(--border);
    font-size: 0.6rem; letter-spacing: .2em;
  }
  .divider::before, .divider::after {
    content: ''; flex: 1; height: 1px; background: var(--border);
  }

  /* Stats strip */
  .stats-strip {
    display: grid; grid-template-columns: repeat(3,1fr);
    gap: 10px; margin-bottom: 24px;
  }
  .stat-box {
    background: var(--card-bg); border: 1px solid var(--border);
    border-radius: 12px; padding: 12px 8px; text-align: center;
  }
  .stat-num { font-size: 1.4rem; font-weight: 700; color: var(--gold); line-height: 1; }
  .stat-lbl { font-size: 0.6rem; color: var(--muted); margin-top: 4px; letter-spacing: .1em; text-transform: uppercase; }

  /* Category pills */
  .cat-row {
    display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 22px;
  }
  .cat-pill {
    background: var(--card-bg); border: 1px solid var(--border);
    border-radius: 99px; padding: 6px 14px; font-size: 0.72rem;
    color: var(--muted); cursor: pointer; transition: all .15s;
    font-family: inherit; letter-spacing: .06em;
  }
  .cat-pill.active { background: var(--vermilion); border-color: var(--vermilion); color: var(--cream); }
  .cat-pill:active { transform: scale(0.95); }

  /* Start button */
  .start-btn {
    width: 100%; background: var(--vermilion); border: none;
    border-radius: 16px; padding: 20px; font-family: inherit;
    font-size: 1rem; font-weight: 700; color: var(--cream);
    cursor: pointer; letter-spacing: .1em; text-transform: uppercase;
    transition: all .15s; box-shadow: 0 4px 20px rgba(200,55,45,0.35);
    position: relative; overflow: hidden;
  }
  .start-btn::after {
    content: '‚Üí'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
    font-size: 1.2rem;
  }
  .start-btn:active { transform: scale(0.98); opacity: 0.9; }

  /* ‚îÄ‚îÄ Flashcard page ‚îÄ‚îÄ */
  .fc-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 0 18px;
  }
  .fc-end-btn {
    background: none; border: 1px solid var(--border); border-radius: 8px;
    padding: 6px 12px; font-family: inherit; font-size: 0.7rem;
    color: var(--muted); cursor: pointer; letter-spacing: .08em;
    transition: all .15s;
  }
  .fc-end-btn:active { background: var(--surface); }
  .fc-progress-wrap { flex: 1; margin: 0 14px; }
  .fc-progress-bar {
    height: 4px; background: var(--border); border-radius: 99px; overflow: hidden;
  }
  .fc-progress-fill {
    height: 100%; background: var(--gold); border-radius: 99px;
    transition: width .3s ease;
  }
  .fc-counter { font-size: 0.65rem; color: var(--muted); text-align: right; margin-top: 4px; letter-spacing: .06em; }
  .fc-category-tag {
    font-size: 0.6rem; color: var(--vermilion); letter-spacing: .16em;
    text-transform: uppercase; text-align: center; margin-bottom: 10px;
  }

  /* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
  .card-wrap {
    border-radius: 20px; overflow: hidden; margin-bottom: 14px;
    border: 1px solid var(--border);
    box-shadow: 0 12px 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.04);
    cursor: pointer;
  }
  /* FRONT */
  .card-face {
    background: linear-gradient(160deg, var(--card-bg) 0%, #160A04 100%);
    height: 210px; display: flex; flex-direction: column;
    align-items: center; justify-content: center; padding: 20px;
    position: relative;
  }
  .card-face::before {
    content: ''; position: absolute; inset: 0;
    background: radial-gradient(ellipse at 50% 30%, rgba(212,148,58,0.08) 0%, transparent 70%);
  }
  .kanji-giant {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    font-size: clamp(80px, 24vw, 120px);
    color: var(--cream); line-height: 1; font-weight: 700;
    text-shadow: 0 0 60px rgba(212,148,58,0.2);
    position: relative; z-index: 1;
  }
  .card-hint {
    font-size: 0.6rem; color: var(--muted); margin-top: 14px;
    letter-spacing: .2em; text-transform: uppercase; position: relative; z-index: 1;
  }
  /* BACK */
  .card-back {
    background: var(--surface);
    max-height: 210px; overflow-y: auto;
    padding: 16px 18px;
    display: none;
  }
  .card-wrap.revealed .card-face { display: none; }
  .card-wrap.revealed .card-back { display: block; }

  .back-top { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 8px; }
  .back-meaning {
    font-family: 'Hiragino Mincho ProN', 'Yu Mincho', 'Georgia', serif;
    font-size: 1.5rem; font-weight: 600; color: var(--cream); line-height: 1.1;
  }
  .back-kanji-mini {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    font-size: 2rem; font-weight: 700; color: var(--gold); line-height: 1;
  }
  .back-reading {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    font-size: 0.82rem; color: var(--gold); margin-bottom: 10px; opacity: 0.85;
  }
  .back-divider { height: 1px; background: var(--border); margin-bottom: 10px; }
  .back-examples { list-style: none; }
  .back-examples li {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    font-size: 0.78rem; color: var(--cream); opacity: 0.8;
    padding: 5px 0; border-bottom: 1px solid rgba(58,40,32,0.6);
    line-height: 1.5; display: flex; align-items: center; gap: 6px;
  }
  .back-examples li:last-child { border-bottom: none; }
  .back-examples li .ex-save {
    margin-left: auto; background: none; border: none; font-size: 0.9rem;
    cursor: pointer; padding: 2px 4px; color: var(--muted); flex-shrink: 0;
    opacity: 0.6; transition: opacity .15s;
  }
  .back-examples li .ex-save:active { opacity: 1; }

  /* ‚îÄ‚îÄ Reveal button ‚îÄ‚îÄ */
  .reveal-btn {
    width: 100%; background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; padding: 16px; font-family: inherit;
    font-size: 0.8rem; color: var(--muted); cursor: pointer;
    letter-spacing: .1em; text-transform: uppercase; margin-bottom: 14px;
    transition: all .15s;
  }
  .reveal-btn:active { background: var(--card-bg); color: var(--cream); }
  .reveal-btn.hidden, .hidden { display: none !important; }

  /* ‚îÄ‚îÄ Rating buttons ‚îÄ‚îÄ */
  .rating-label {
    font-size: 0.6rem; color: var(--muted); text-align: center;
    letter-spacing: .14em; text-transform: uppercase; margin-bottom: 8px;
  }
  .rating-btns { display: grid; grid-template-columns: repeat(5,1fr); gap: 7px; }
  .rating-btn {
    border-radius: 12px; padding: 11px 4px 9px; font-family: inherit;
    cursor: pointer; transition: all .15s;
    display: flex; flex-direction: column; align-items: center; gap: 3px;
    border: 1px solid transparent;
  }
  .rating-btn:active { transform: scale(0.93); }
  .rating-btn .r-num { font-size: 1rem; font-weight: 700; line-height: 1; }
  .rating-btn .r-lbl { font-size: 0.52rem; line-height: 1.2; text-align: center; opacity: 0.8; }
  .rating-btn[data-r="1"] { background: rgba(200,55,45,0.15); border-color: rgba(200,55,45,0.4); color: #E06055; }
  .rating-btn[data-r="2"] { background: rgba(200,120,40,0.15); border-color: rgba(200,120,40,0.4); color: #D4843A; }
  .rating-btn[data-r="3"] { background: rgba(180,160,40,0.15); border-color: rgba(180,160,40,0.4); color: #C8B040; }
  .rating-btn[data-r="4"] { background: rgba(60,140,80,0.15); border-color: rgba(60,140,80,0.4); color: #50B870; }
  .rating-btn[data-r="5"] { background: rgba(60,100,200,0.15); border-color: rgba(60,100,200,0.4); color: #6090E0; }

  /* ‚îÄ‚îÄ Summary ‚îÄ‚îÄ */
  .summary-wrap { text-align: center; padding: 40px 0 20px; }
  .summary-bowl {
    font-size: 64px; margin-bottom: 16px; display: block;
  }
  .summary-title {
    font-family: 'Hiragino Mincho ProN', 'Yu Mincho', 'Georgia', serif;
    font-size: 1.4rem; color: var(--cream); margin-bottom: 6px;
  }
  .summary-sub { font-size: 0.72rem; color: var(--muted); letter-spacing: .1em; margin-bottom: 28px; }
  .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px; }
  .sum-box {
    background: var(--card-bg); border: 1px solid var(--border);
    border-radius: 14px; padding: 16px;
  }
  .sum-num { font-size: 2rem; font-weight: 700; line-height: 1; }
  .sum-lbl { font-size: 0.62rem; color: var(--muted); margin-top: 4px; letter-spacing: .08em; text-transform: uppercase; }
  .sum-num.good { color: #50B870; }
  .sum-num.bad { color: #E06055; }

  .action-btn {
    width: 100%; background: var(--card-bg); border: 1px solid var(--border);
    border-radius: 14px; padding: 16px 18px; font-family: inherit;
    font-size: 0.85rem; color: var(--cream); cursor: pointer;
    display: flex; align-items: center; gap: 12px; margin-bottom: 10px;
    transition: all .15s;
  }
  .action-btn:active { background: var(--surface); }
  .action-btn .a-icon { font-size: 1.3rem; flex-shrink: 0; }
  .action-btn .a-text { text-align: left; flex: 1; }
  .action-btn .a-label { font-size: 0.85rem; display: block; }
  .action-btn .a-sub { font-size: 0.65rem; color: var(--muted); display: block; margin-top: 2px; }
  .action-btn.primary { background: var(--vermilion); border-color: var(--vermilion); }
  .action-btn.primary .a-sub { color: rgba(255,255,255,0.6); }

  /* ‚îÄ‚îÄ Browse page ‚îÄ‚îÄ */
  .page-header {
    display: flex; align-items: center; gap: 12px; padding: 16px 0 20px;
  }
  .back-btn {
    background: none; border: 1px solid var(--border); border-radius: 8px;
    padding: 6px 12px; font-family: inherit; font-size: 0.7rem;
    color: var(--muted); cursor: pointer; flex-shrink: 0;
    transition: all .15s;
  }
  .back-btn:active { background: var(--surface); }
  .page-title {
    font-family: 'Hiragino Mincho ProN', 'Yu Mincho', 'Georgia', serif;
    font-size: 1.1rem; color: var(--cream);
  }

  /* Browse filter tabs */
  .filter-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 12px; margin-bottom: 4px; }
  .filter-tab {
    flex-shrink: 0; background: var(--card-bg); border: 1px solid var(--border);
    border-radius: 99px; padding: 6px 14px; font-family: inherit;
    font-size: 0.68rem; color: var(--muted); cursor: pointer;
    white-space: nowrap; transition: all .15s; letter-spacing: .06em;
  }
  .filter-tab.active { background: var(--vermilion); border-color: var(--vermilion); color: var(--cream); }

  /* Browse grid */
  .browse-list { display: flex; flex-direction: column; gap: 8px; }
  .browse-item {
    background: var(--card-bg); border: 1px solid var(--border);
    border-radius: 14px; padding: 12px 14px;
    display: flex; align-items: center; gap: 12px;
    cursor: pointer; transition: all .15s;
  }
  .browse-item:active { background: var(--surface); }
  .browse-kanji {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    font-size: 1.8rem; font-weight: 700; color: var(--gold);
    width: 44px; text-align: center; flex-shrink: 0;
  }
  .browse-info { flex: 1; min-width: 0; }
  .browse-meaning { font-size: 0.9rem; color: var(--cream); font-weight: 500; }
  .browse-hira { font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif; font-size: 0.72rem; color: var(--muted); margin-top: 2px; }
  .browse-rating {
    font-size: 0.7rem; font-weight: 700; padding: 3px 8px;
    border-radius: 6px; flex-shrink: 0;
  }
  .browse-rating.new { background: rgba(138,122,98,0.2); color: var(--muted); }
  .browse-rating.r1  { background: rgba(200,55,45,0.2); color: #E06055; }
  .browse-rating.r2  { background: rgba(200,120,40,0.2); color: #D4843A; }
  .browse-rating.r3  { background: rgba(180,160,40,0.2); color: #C8B040; }
  .browse-rating.r4  { background: rgba(60,140,80,0.2); color: #50B870; }
  .browse-rating.r5  { background: rgba(60,100,200,0.2); color: #6090E0; }

  /* ‚îÄ‚îÄ Detail page ‚îÄ‚îÄ */
  .detail-kanji-block {
    background: linear-gradient(160deg, var(--card-bg), #160A04);
    border: 1px solid var(--border); border-radius: 20px;
    padding: 32px 24px; text-align: center; margin-bottom: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  }
  .detail-kanji {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    font-size: clamp(72px,20vw,96px); font-weight: 700;
    color: var(--cream); line-height: 1;
    text-shadow: 0 0 40px rgba(212,148,58,0.25);
  }
  .detail-meaning {
    font-family: 'Hiragino Mincho ProN', 'Yu Mincho', 'Georgia', serif;
    font-size: 1.4rem; color: var(--gold); margin-top: 10px;
  }
  .detail-reading {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    font-size: 0.85rem; color: var(--muted); margin-top: 6px;
  }
  .detail-cat {
    display: inline-block; background: var(--vermilion);
    border-radius: 99px; padding: 3px 10px; font-size: 0.6rem;
    letter-spacing: .12em; text-transform: uppercase; margin-top: 10px; color: var(--cream);
  }
  .detail-section { margin-bottom: 16px; }
  .detail-section-title {
    font-size: 0.6rem; color: var(--muted); letter-spacing: .18em;
    text-transform: uppercase; margin-bottom: 8px;
  }
  .detail-examples { list-style: none; }
  .detail-examples li {
    font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', -apple-system, sans-serif;
    font-size: 0.82rem; color: var(--cream); opacity: 0.85;
    padding: 8px 0; border-bottom: 1px solid var(--border);
    line-height: 1.5;
  }
  .detail-examples li:last-child { border-bottom: none; }
  .detail-rating-row {
    background: var(--card-bg); border: 1px solid var(--border);
    border-radius: 12px; padding: 12px 14px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .detail-rating-lbl { font-size: 0.72rem; color: var(--muted); }
  .detail-rating-val { font-size: 0.85rem; font-weight: 600; }

  /* ‚îÄ‚îÄ Nav bar ‚îÄ‚îÄ */
  .nav-bar {
    position: fixed; bottom: 0; left: 0; right: 0; z-index: 100;
    background: var(--lacquer); border-top: 1px solid var(--border);
    display: flex; max-width: 420px; margin: 0 auto;
    padding-bottom: env(safe-area-inset-bottom, 0);
  }
  /* offset pages for nav */
  .page { padding-bottom: 80px; }
  .nav-item {
    flex: 1; display: flex; flex-direction: column; align-items: center;
    padding: 10px 4px; cursor: pointer; transition: all .15s;
    background: none; border: none; font-family: inherit;
    color: var(--muted); font-size: 0.55rem; letter-spacing: .08em;
    text-transform: uppercase; gap: 4px;
  }
  .nav-item .nav-icon { font-size: 1.3rem; }
  .nav-item.active { color: var(--gold); }
  .nav-item:active { opacity: 0.7; }

  /* Make nav bar centred on wide screens */
  @media (min-width: 420px) {
    .nav-bar { left: 50%; right: auto; transform: translateX(-50%); width: 420px; }
  }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê HOME PAGE ‚ïê‚ïê‚ïê -->
<div class="page active" id="page-home">
  <div class="home-header">
    <span class="home-crest">È£ü</span>
    <div class="home-title">Food Kanji</div>
    <div class="home-sub">Japanese Restaurant Guide</div>
  </div>

  <div class="stats-strip" id="home-stats">
    <div class="stat-box"><div class="stat-num" id="stat-studied">0</div><div class="stat-lbl">Studied</div></div>
    <div class="stat-box"><div class="stat-num" id="stat-known">0</div><div class="stat-lbl">Known</div></div>
    <div class="stat-box"><div class="stat-num" id="stat-total">0</div><div class="stat-lbl">Total</div></div>
  </div>

  <div class="divider">Study by category</div>

  <div class="cat-row" id="cat-row">
    <button class="cat-pill active" data-cat="all" onclick="selectCat(this,'all')">All</button>
  </div>

  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
    <span style="font-size:0.68rem;color:var(--muted);letter-spacing:.1em;text-transform:uppercase">Cards</span>
    <div style="display:flex;align-items:center;gap:8px">
      <input type="number" id="card-count" value="10" min="1" max="54"
        style="width:56px;background:var(--card-bg);border:1px solid var(--border);border-radius:8px;
               padding:6px 8px;font-family:inherit;font-size:0.9rem;color:var(--cream);text-align:center;outline:none">
    </div>
  </div>
  <button class="start-btn" onclick="startFlashcards()" style="margin-bottom:14px">
    Start Flashcards
  </button>
  <button class="start-btn" onclick="startFlashcards(true)"
    style="background:var(--surface);box-shadow:none;border:1px solid var(--border);margin-bottom:0">
    üîÅ Review Weak Cards
  </button>
</div>

<!-- ‚ïê‚ïê‚ïê FLASHCARD PAGE ‚ïê‚ïê‚ïê -->
<div class="page" id="page-flashcard">
  <div class="fc-header">
    <button class="fc-end-btn" onclick="endSession()">‚úï End</button>
    <div class="fc-progress-wrap">
      <div class="fc-progress-bar"><div class="fc-progress-fill" id="fc-fill" style="width:0%"></div></div>
      <div class="fc-counter" id="fc-counter">1 / 10</div>
    </div>
  </div>

  <div class="fc-category-tag" id="fc-cat-tag">Protein</div>

  <div class="card-wrap" id="cardWrap" onclick="revealCard()">
    <div class="card-face">
      <div class="kanji-giant" id="fc-kanji">È£ü</div>
      <div class="card-hint">Tap to reveal</div>
    </div>
    <div class="card-back" id="cardBack">
      <div class="back-top">
        <div>
          <div class="back-meaning" id="cb-meaning"></div>
          <div class="back-reading" id="cb-reading"></div>
        </div>
        <div class="back-kanji-mini" id="cb-kanji-mini"></div>
      </div>
      <div class="back-divider"></div>
      <ul class="back-examples" id="cb-examples"></ul>
    </div>
  </div>

  <button class="reveal-btn" id="reveal-btn" onclick="revealCard()">Tap card ¬∑ or tap here to reveal</button>

  <div class="hidden" id="answer-btns">
    <div class="rating-label">How well did you know it?</div>
    <div class="rating-btns">
      <button class="rating-btn" data-r="1" onclick="rateCard(1)"><span class="r-num">1</span><span class="r-lbl">Not at all</span></button>
      <button class="rating-btn" data-r="2" onclick="rateCard(2)"><span class="r-num">2</span><span class="r-lbl">Seen it</span></button>
      <button class="rating-btn" data-r="3" onclick="rateCard(3)"><span class="r-num">3</span><span class="r-lbl">Almost</span></button>
      <button class="rating-btn" data-r="4" onclick="rateCard(4)"><span class="r-num">4</span><span class="r-lbl">Know it</span></button>
      <button class="rating-btn" data-r="5" onclick="rateCard(5)"><span class="r-num">5</span><span class="r-lbl">Expert</span></button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SUMMARY PAGE ‚ïê‚ïê‚ïê -->
<div class="page" id="page-summary">
  <div class="summary-wrap">
    <span class="summary-bowl" id="sum-emoji">üçú</span>
    <div class="summary-title">Session Complete</div>
    <div class="summary-sub" id="sum-sub">10 cards reviewed</div>
    <div class="summary-grid">
      <div class="sum-box"><div class="sum-num good" id="sum-known">0</div><div class="sum-lbl">Known (4‚Äì5)</div></div>
      <div class="sum-box"><div class="sum-num bad" id="sum-weak">0</div><div class="sum-lbl">To review (1‚Äì3)</div></div>
    </div>
  </div>
  <button class="action-btn primary" onclick="startFlashcards(false, true)">
    <span class="a-icon">üîÅ</span>
    <span class="a-text"><span class="a-label">Repeat this set</span><span class="a-sub">Same cards, reshuffled</span></span>
  </button>
  <button class="action-btn" id="sum-retry-btn" onclick="retryWeak()">
    <span class="a-icon">‚ö†Ô∏è</span>
    <span class="a-text"><span class="a-label">Retry weak cards</span><span class="a-sub" id="sum-retry-sub">0 cards rated 1‚Äì3</span></span>
  </button>
  <button class="action-btn" onclick="showPage('home')">
    <span class="a-icon">üè†</span>
    <span class="a-text"><span class="a-label">Back to home</span><span class="a-sub">Choose a new set</span></span>
  </button>
</div>

<!-- ‚ïê‚ïê‚ïê BROWSE PAGE ‚ïê‚ïê‚ïê -->
<div class="page" id="page-browse">
  <div class="page-header">
    <button class="back-btn" onclick="showPage('home')">‚Üê Back</button>
    <div class="page-title">Browse All Kanji</div>
  </div>
  <div class="filter-row" id="browse-filters"></div>
  <div class="browse-list" id="browse-list"></div>
</div>

<!-- ‚ïê‚ïê‚ïê DETAIL PAGE ‚ïê‚ïê‚ïê -->
<div class="page" id="page-detail">
  <div class="page-header">
    <button class="back-btn" onclick="showPage('browse')">‚Üê Browse</button>
    <div class="page-title">Detail</div>
  </div>
  <div class="detail-kanji-block">
    <div class="detail-kanji" id="det-kanji"></div>
    <div class="detail-meaning" id="det-meaning"></div>
    <div class="detail-reading" id="det-reading"></div>
    <span class="detail-cat" id="det-cat"></span>
  </div>
  <div class="detail-section">
    <div class="detail-section-title">Examples</div>
    <ul class="detail-examples" id="det-examples"></ul>
  </div>
  <div class="detail-rating-row">
    <span class="detail-rating-lbl">Your rating</span>
    <span class="detail-rating-val" id="det-rating">Not studied yet</span>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê NAV BAR ‚ïê‚ïê‚ïê -->
<nav class="nav-bar">
  <button class="nav-item active" id="nav-home" onclick="navTo('home')">
    <span class="nav-icon">üèÆ</span>Home
  </button>
  <button class="nav-item" id="nav-browse" onclick="navTo('browse')">
    <span class="nav-icon">üìñ</span>Browse
  </button>
</nav>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// KANJI DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const KANJI = [
  {kanji:"È≠ö",meaning:"Fish",hiragana:"„Åï„Åã„Å™ / „Åé„Çá",category:"Protein",examples:["È≠ö („Åï„Åã„Å™) fish","Âà∫Ë∫´ („Åï„Åó„Åø) sashimi","ÁÑº„ÅçÈ≠ö („ÇÑ„Åç„Åñ„Åã„Å™) grilled fish"]},
  {kanji:"ËÇâ",meaning:"Meat",hiragana:"„Å´„Åè",category:"Protein",examples:["ËÇâ („Å´„Åè) meat","ÁÑº„ÅçËÇâ („ÇÑ„Åç„Å´„Åè) grilled meat","ËÇâÊñôÁêÜ („Å´„Åè„Çä„Çá„ÅÜ„Çä) meat dish"]},
  {kanji:"Ë±ö",meaning:"Pork",hiragana:"„Å∂„Åü / „Å®„Çì",category:"Protein",examples:["Ë±öËÇâ („Å∂„Åü„Å´„Åè) pork","Ë±ö„Ç´„ÉÑ („Å®„Çì„Åã„Å§) pork cutlet","Ë±öÈ™® („Å®„Çì„Åì„Å§) pork bone broth"]},
  {kanji:"Áâõ",meaning:"Beef",hiragana:"„ÅÜ„Åó / „Åé„ÇÖ„ÅÜ",category:"Protein",examples:["ÁâõËÇâ („Åé„ÇÖ„ÅÜ„Å´„Åè) beef","Áâõ‰∏º („Åé„ÇÖ„ÅÜ„Å©„Çì) beef bowl","Áâõ‰π≥ („Åé„ÇÖ„ÅÜ„Å´„ÇÖ„ÅÜ) milk"]},
  {kanji:"È∂è",meaning:"Chicken",hiragana:"„Å®„Çä / „Åë„ÅÑ",category:"Protein",examples:["È∂èËÇâ („Å®„Çä„Å´„Åè) chicken","ÂîêÊèö„Åí („Åã„Çâ„ÅÇ„Åí) fried chicken","È∂èÂçµ („Åë„ÅÑ„Çâ„Çì) chicken egg"]},
  {kanji:"Âçµ",meaning:"Egg",hiragana:"„Åü„Åæ„Åî / „Çâ„Çì",category:"Protein",examples:["Âçµ („Åü„Åæ„Åî) egg","ÂçµÁÑº„Åç („Åü„Åæ„Åî„ÇÑ„Åç) rolled omelette","ÂçäÁÜüÂçµ („ÅØ„Çì„Åò„ÇÖ„Åè„Åü„Åæ„Åî) soft-boiled egg"]},
  {kanji:"Ëüπ",meaning:"Crab",hiragana:"„Åã„Å´",category:"Protein",examples:["Ëüπ („Åã„Å´) crab","ËüπÈçã („Åã„Å´„Å™„Åπ) crab hot pot","ËüπÂë≥Âôå („Åã„Å´„Åø„Åù) crab innards"]},
  {kanji:"Êµ∑ËÄÅ",meaning:"Shrimp / Prawn",hiragana:"„Åà„Å≥",category:"Protein",examples:["Êµ∑ËÄÅ („Åà„Å≥) shrimp","Êµ∑ËÄÅÂ§© („Åà„Å≥„Å¶„Çì) shrimp tempura","Êµ∑ËÄÅ„Éï„É©„Ç§ („Åà„Å≥„Åµ„Çâ„ÅÑ) fried shrimp"]},
  {kanji:"ÁÑº",meaning:"Grilled / Fried",hiragana:"„ÇÑ„Åç / „Åó„Çá„ÅÜ",category:"Cooking",examples:["ÁÑº„Åè („ÇÑ„Åè) to grill","ÁÑº„ÅçÈ≥• („ÇÑ„Åç„Å®„Çä) grilled chicken skewer","ÁÑº„ÅçÈ£Ø („ÇÑ„Åç„ÇÅ„Åó) fried rice"]},
  {kanji:"Êèö",meaning:"Deep-fried",hiragana:"„ÅÇ„Åí / „Çà„ÅÜ",category:"Cooking",examples:["Êèö„Åí„Çã („ÅÇ„Åí„Çã) to deep fry","ÂîêÊèö„Åí („Åã„Çâ„ÅÇ„Åí) fried chicken","Â§©„Å∑„Çâ („Å¶„Çì„Å∑„Çâ) tempura"]},
  {kanji:"ÁÖÆ",meaning:"Simmered",hiragana:"„Å´ / „Åó„ÇÉ",category:"Cooking",examples:["ÁÖÆ„Çã („Å´„Çã) to simmer","ÁÖÆÁâ© („Å´„ÇÇ„ÅÆ) simmered dish","ÁÖÆËæº„Åø („Å´„Åì„Åø) stew"]},
  {kanji:"Ëí∏",meaning:"Steamed",hiragana:"„ÇÄ / „Åò„Çá„ÅÜ",category:"Cooking",examples:["Ëí∏„Åô („ÇÄ„Åô) to steam","Ëí∏„ÅóÊñôÁêÜ („ÇÄ„Åó„Çä„Çá„ÅÜ„Çä) steamed dish","Ëå∂Á¢óËí∏„Åó („Å°„ÇÉ„Çè„Çì„ÇÄ„Åó) egg custard"]},
  {kanji:"Áîü",meaning:"Raw / Fresh",hiragana:"„Å™„Åæ / „Åõ„ÅÑ",category:"Cooking",examples:["Áîü („Å™„Åæ) raw / fresh","Áîü„Éì„Éº„É´ („Å™„Åæ„Å≥„Éº„Çã) draft beer","ÁîüÈ≠ö („Å™„Åæ„Åñ„Åã„Å™) raw fish"]},
  {kanji:"ÁÇí",meaning:"Stir-fried",hiragana:"„ÅÑ„Åü / „Åó„Çá„ÅÜ",category:"Cooking",examples:["ÁÇí„ÇÅ„Çã („ÅÑ„Åü„ÇÅ„Çã) to stir-fry","ÁÇí„ÇÅÁâ© („ÅÑ„Åü„ÇÅ„ÇÇ„ÅÆ) stir-fry dish","ÈáéËèúÁÇí„ÇÅ („ÇÑ„Åï„ÅÑ„ÅÑ„Åü„ÇÅ) veg stir-fry"]},
  {kanji:"Êº¨",meaning:"Pickled",hiragana:"„Å§„Åë / „Å•„Åë",category:"Cooking",examples:["Êº¨Áâ© („Å§„Åë„ÇÇ„ÅÆ) pickles","Êº¨„Åë„Çã („Å§„Åë„Çã) to pickle","ÈÜ§Ê≤πÊº¨„Åë („Åó„Çá„ÅÜ„ÇÜ„Å•„Åë) soy marinade"]},
  {kanji:"È∫∫",meaning:"Noodles",hiragana:"„ÇÅ„Çì",category:"Noodles & Rice",examples:["È∫∫ („ÇÅ„Çì) noodles","„É©„Éº„É°„É≥ („Çâ„Éº„ÇÅ„Çì) ramen","ÂÜ∑È∫∫ („Çå„ÅÑ„ÇÅ„Çì) cold noodles"]},
  {kanji:"ËïéÈ∫¶",meaning:"Soba",hiragana:"„Åù„Å∞",category:"Noodles & Rice",examples:["ËïéÈ∫¶ („Åù„Å∞) soba noodles","ËïéÈ∫¶Â±ã („Åù„Å∞„ÇÑ) soba restaurant","„Åñ„ÇãËïéÈ∫¶ („Åñ„Çã„Åù„Å∞) cold soba on bamboo"]},
  {kanji:"È£Ø",meaning:"Rice / Meal",hiragana:"„ÇÅ„Åó / „Åî„ÅØ„Çì",category:"Noodles & Rice",examples:["„ÅîÈ£Ø („Åî„ÅØ„Çì) rice / meal","ÁÇä„ÅçËæº„Åø„ÅîÈ£Ø („Åü„Åç„Åì„Åø„Åî„ÅØ„Çì) seasoned rice","ÁôΩÈ£Ø („Åó„Çç„ÇÅ„Åó) plain white rice"]},
  {kanji:"‰∏º",meaning:"Rice Bowl",hiragana:"„Å©„Çì„Å∂„Çä / „Å©„Çì",category:"Noodles & Rice",examples:["‰∏º („Å©„Çì„Å∂„Çä) rice bowl","Áâõ‰∏º („Åé„ÇÖ„ÅÜ„Å©„Çì) beef bowl","Ë¶™Â≠ê‰∏º („Åä„ÇÑ„Åì„Å©„Çì) chicken & egg bowl"]},
  {kanji:"ÂØøÂè∏",meaning:"Sushi",hiragana:"„Åô„Åó",category:"Noodles & Rice",examples:["ÂØøÂè∏ („Åô„Åó) sushi","ÂõûËª¢ÂØøÂè∏ („Åã„ÅÑ„Å¶„Çì„Åö„Åó) conveyor belt sushi","Êè°„ÇäÂØøÂè∏ („Å´„Åé„Çä„Åö„Åó) hand-formed sushi"]},
  {kanji:"ÈáéËèú",meaning:"Vegetables",hiragana:"„ÇÑ„Åï„ÅÑ",category:"Vegetables",examples:["ÈáéËèú („ÇÑ„Åï„ÅÑ) vegetables","ÈáéËèúÁÇí„ÇÅ („ÇÑ„Åï„ÅÑ„ÅÑ„Åü„ÇÅ) stir-fried vegetables","ÈáéËèú„Çµ„É©„ÉÄ („ÇÑ„Åï„ÅÑ„Åï„Çâ„Å†) vegetable salad"]},
  {kanji:"Ë±ÜËÖê",meaning:"Tofu",hiragana:"„Å®„ÅÜ„Åµ",category:"Vegetables",examples:["Ë±ÜËÖê („Å®„ÅÜ„Åµ) tofu","ÂÜ∑Â•¥ („Å≤„ÇÑ„ÇÑ„Å£„Åì) cold tofu","Êèö„ÅíË±ÜËÖê („ÅÇ„Åí„Å©„ÅÜ„Åµ) fried tofu"]},
  {kanji:"Ëå∏",meaning:"Mushroom",hiragana:"„Åç„ÅÆ„Åì",category:"Vegetables",examples:["Ëå∏ („Åç„ÅÆ„Åì) mushroom","Ê§éËå∏ („Åó„ÅÑ„Åü„Åë) shiitake","ÊùæËå∏ („Åæ„Å§„Åü„Åë) matsutake mushroom"]},
  {kanji:"ÁÜ±",meaning:"Hot",hiragana:"„ÅÇ„Å§ / „Å≠„Å§",category:"Temperature",examples:["ÁÜ±„ÅÑ („ÅÇ„Å§„ÅÑ) hot","ÁÜ±„ÄÖ („ÅÇ„Å§„ÅÇ„Å§) piping hot","ÁÜ±Ááó („ÅÇ„Å§„Åã„Çì) hot sake"]},
  {kanji:"ÂÜ∑",meaning:"Cold",hiragana:"„Å§„ÇÅ / „Çå„ÅÑ",category:"Temperature",examples:["ÂÜ∑„Åü„ÅÑ („Å§„ÇÅ„Åü„ÅÑ) cold","ÂÜ∑„ÇÑ„Åó („Å≤„ÇÑ„Åó) chilled","ÂÜ∑ÈÖí („Çå„ÅÑ„Åó„ÇÖ) cold sake"]},
  {kanji:"Ëæõ",meaning:"Spicy",hiragana:"„Åã„Çâ / „Åó„Çì",category:"Taste",examples:["Ëæõ„ÅÑ („Åã„Çâ„ÅÑ) spicy","ËæõÂè£ („Åã„Çâ„Åè„Å°) spicy/dry","ÂîêËæõÂ≠ê („Å®„ÅÜ„Åå„Çâ„Åó) chilli pepper"]},
  {kanji:"Áîò",meaning:"Sweet",hiragana:"„ÅÇ„Åæ / „Åã„Çì",category:"Taste",examples:["Áîò„ÅÑ („ÅÇ„Åæ„ÅÑ) sweet","ÁîòÂè£ („ÅÇ„Åæ„Åè„Å°) sweet/mild","ÁîòÈÖ¢ („ÅÇ„Åæ„Åö) sweet vinegar"]},
  {kanji:"Â°©",meaning:"Salt",hiragana:"„Åó„Åä / „Åà„Çì",category:"Taste",examples:["Â°© („Åó„Åä) salt","Â°©Âë≥ („Åó„Åä„ÅÇ„Åò) salty flavour","Â°©„É©„Éº„É°„É≥ („Åó„Åä„Çâ„Éº„ÇÅ„Çì) salt ramen"]},
  {kanji:"ÈÜ§Ê≤π",meaning:"Soy Sauce",hiragana:"„Åó„Çá„ÅÜ„ÇÜ",category:"Taste",examples:["ÈÜ§Ê≤π („Åó„Çá„ÅÜ„ÇÜ) soy sauce","ÈÜ§Ê≤π„É©„Éº„É°„É≥ („Åó„Çá„ÅÜ„ÇÜ„Çâ„Éº„ÇÅ„Çì) soy ramen","ÈÜ§Ê≤πÊº¨„Åë („Åó„Çá„ÅÜ„ÇÜ„Å•„Åë) soy marinade"]},
  {kanji:"Âë≥",meaning:"Flavour",hiragana:"„ÅÇ„Åò / „Åø",category:"Taste",examples:["Âë≥ („ÅÇ„Åò) flavour","Âë≥Âôå („Åø„Åù) miso","Ë™øÂë≥Êñô („Å°„Çá„ÅÜ„Åø„Çä„Çá„ÅÜ) seasoning"]},
  {kanji:"ÈÖ∏",meaning:"Sour",hiragana:"„Åô / „Åï„Çì",category:"Taste",examples:["ÈÖ∏„Å£„Å±„ÅÑ („Åô„Å£„Å±„ÅÑ) sour","ÈÖ∏Âë≥ („Åï„Çì„Åø) sourness","ÈÖ¢ („Åô) vinegar"]},
  {kanji:"‰∏Ä",meaning:"One",hiragana:"„ÅÑ„Å° / „Å≤„Å®",category:"Numbers",examples:["‰∏Ä („ÅÑ„Å°) one","‰∏Ä‰∫∫Ââç („ÅÑ„Å°„Å´„Çì„Åæ„Åà) one serving","‰∏ÄÂìÅ („ÅÑ„Å£„Å¥„Çì) one dish"]},
  {kanji:"‰∫å",meaning:"Two",hiragana:"„Å´ / „Åµ„Åü",category:"Numbers",examples:["‰∫å („Å´) two","‰∫å‰∫∫Ââç („Åµ„Åü„Çä„Åæ„Åà) two servings","‰∫åÊùØ („Å´„ÅØ„ÅÑ) two cups"]},
  {kanji:"‰∏â",meaning:"Three",hiragana:"„Åï„Çì / „Åø",category:"Numbers",examples:["‰∏â („Åï„Çì) three","‰∏â‰∫∫Ââç („Åï„Çì„Å´„Çì„Åæ„Åà) three servings","‰∏âÊùØ („Åï„Çì„Å∞„ÅÑ) three cups"]},
  {kanji:"Âõõ",meaning:"Four",hiragana:"„Åó / „Çà„Çì",category:"Numbers",examples:["Âõõ („Åó/„Çà„Çì) four","Âõõ‰∫∫ („Çà„Å´„Çì) four people","ÂõõÂìÅ („Åó„Å≤„Çì) four dishes"]},
  {kanji:"‰∫î",meaning:"Five",hiragana:"„Åî / „ÅÑ„Å§",category:"Numbers",examples:["‰∫î („Åî) five","‰∫î‰∫∫Ââç („Åî„Å´„Çì„Åæ„Åà) five servings","‰∫îÁõÆ („Åî„ÇÇ„Åè) five-ingredient mix"]},
  {kanji:"ÂÖ≠",meaning:"Six",hiragana:"„Çç„Åè / „ÇÄ„Å£",category:"Numbers",examples:["ÂÖ≠ („Çç„Åè) six","ÂÖ≠‰∫∫ („Çç„Åè„Å´„Çì) six people","ÂÖ≠ÂìÅ („Çç„Å£„Å¥„Çì) six dishes"]},
  {kanji:"‰∏É",meaning:"Seven",hiragana:"„Åó„Å° / „Å™„Å™",category:"Numbers",examples:["‰∏É („Åó„Å°) seven","‰∏ÉÂë≥ („Åó„Å°„Åø) seven-spice blend","‰∏ÉÂìÅ („Å™„Å™„Åó„Å™) seven dishes"]},
  {kanji:"ÂÖ´",meaning:"Eight",hiragana:"„ÅØ„Å° / „ÇÑ„Å£",category:"Numbers",examples:["ÂÖ´ („ÅØ„Å°) eight","ÂÖ´ÂÆùËèú („ÅØ„Å£„ÅΩ„ÅÜ„Åï„ÅÑ) eight treasure stir-fry","ÂÖ´ÂìÅ („ÅØ„Å°„Å≤„Çì) eight dishes"]},
  {kanji:"‰πù",meaning:"Nine",hiragana:"„Åè / „Åç„ÇÖ„ÅÜ",category:"Numbers",examples:["‰πù („Åè/„Åç„ÇÖ„ÅÜ) nine","‰πùÂ∑û („Åç„ÇÖ„ÅÜ„Åó„ÇÖ„ÅÜ) Kyushu region","‰πùÂìÅ („Åè„Åª„Çì) nine dishes"]},
  {kanji:"ÂçÅ",meaning:"Ten",hiragana:"„Åò„ÇÖ„ÅÜ / „Å®„Åä",category:"Numbers",examples:["ÂçÅ („Åò„ÇÖ„ÅÜ) ten","ÂçÅ‰∫∫Ââç („Åò„ÇÖ„ÅÜ„Å´„Çì„Åæ„Åà) ten servings","ÂçÅÂìÅ („Åò„Å£„Å¥„Çì) ten dishes"]},
  {kanji:"ÈÖí",meaning:"Sake / Alcohol",hiragana:"„Åï„Åë / „Åó„ÇÖ",category:"Drinks",examples:["„ÅäÈÖí („Åä„Åï„Åë) sake / alcohol","Êó•Êú¨ÈÖí („Å´„Åª„Çì„Åó„ÇÖ) Japanese sake","Â±ÖÈÖíÂ±ã („ÅÑ„Åñ„Åã„ÇÑ) izakaya bar"]},
  {kanji:"Ëå∂",meaning:"Tea",hiragana:"„Å°„ÇÉ / „Åï",category:"Drinks",examples:["„ÅäËå∂ („Åä„Å°„ÇÉ) tea","Á∑ëËå∂ („Çä„Çá„Åè„Å°„ÇÉ) green tea","È∫¶Ëå∂ („ÇÄ„Åé„Å°„ÇÉ) barley tea"]},
  {kanji:"Ê∞¥",meaning:"Water",hiragana:"„Åø„Åö / „Åô„ÅÑ",category:"Drinks",examples:["Ê∞¥ („Åø„Åö) water","„ÅäÊ∞¥ („Åä„Åø„Åö) water (polite)","ÁÇ≠ÈÖ∏Ê∞¥ („Åü„Çì„Åï„Çì„Åô„ÅÑ) sparkling water"]},
  {kanji:"È£ü",meaning:"Eat / Food",hiragana:"„Åü / „Åó„Çá„Åè",category:"Restaurant",examples:["È£ü„Åπ„Çã („Åü„Åπ„Çã) to eat","È£ü‰∫ã („Åó„Çá„Åè„Åò) meal","È£üÂ†Ç („Åó„Çá„Åè„Å©„ÅÜ) canteen"]},
  {kanji:"È£≤",meaning:"Drink",hiragana:"„ÅÆ / „ÅÑ„Çì",category:"Restaurant",examples:["È£≤„ÇÄ („ÅÆ„ÇÄ) to drink","È£≤„ÅøÁâ© („ÅÆ„Åø„ÇÇ„ÅÆ) drink","È£≤È£üÂ∫ó („ÅÑ„Çì„Åó„Çá„Åè„Å¶„Çì) restaurant"]},
  {kanji:"Ê≥®Êñá",meaning:"Order",hiragana:"„Å°„ÇÖ„ÅÜ„ÇÇ„Çì",category:"Restaurant",examples:["Ê≥®Êñá („Å°„ÇÖ„ÅÜ„ÇÇ„Çì) order","Ê≥®Êñá„Åô„Çã („Å°„ÇÖ„ÅÜ„ÇÇ„Çì„Åô„Çã) to order","„ÅîÊ≥®Êñá„ÅØÔºü („Åî„Å°„ÇÖ„ÅÜ„ÇÇ„Çì„ÅØÔºü) What would you like?"]},
  {kanji:"ÂÆöÈ£ü",meaning:"Set Meal",hiragana:"„Å¶„ÅÑ„Åó„Çá„Åè",category:"Restaurant",examples:["ÂÆöÈ£ü („Å¶„ÅÑ„Åó„Çá„Åè) set meal","Êú¨Êó•„ÅÆÂÆöÈ£ü („Åª„Çì„Åò„Å§„ÅÆ„Å¶„ÅÑ„Åó„Çá„Åè) today's set","ÂÆöÁï™ („Å¶„ÅÑ„Å∞„Çì) classic dish"]},
  {kanji:"Â∏≠",meaning:"Seat",hiragana:"„Åõ„Åç",category:"Restaurant",examples:["Â∏≠ („Åõ„Åç) seat","„ÅäÂ∏≠ („Åä„Åõ„Åç) seat (polite)","Á¶ÅÁÖôÂ∏≠ („Åç„Çì„Åà„Çì„Åõ„Åç) non-smoking seat"]},
  {kanji:"‰ºöË®à",meaning:"The Bill",hiragana:"„Åã„ÅÑ„Åë„ÅÑ",category:"Restaurant",examples:["‰ºöË®à („Åã„ÅÑ„Åë„ÅÑ) bill / check","„Åä‰ºöË®à („Åä„Åã„ÅÑ„Åë„ÅÑ) the bill (polite)","„Åä‰ºöË®à„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô check please"]},
  {kanji:"Á¶ÅÁÖô",meaning:"No Smoking",hiragana:"„Åç„Çì„Åà„Çì",category:"Restaurant",examples:["Á¶ÅÁÖô („Åç„Çì„Åà„Çì) no smoking","Á¶ÅÁÖôÂ∏≠ („Åç„Çì„Åà„Çì„Åõ„Åç) non-smoking seat","Á¶ÅÁÖô„Ç®„É™„Ç¢ („Åç„Çì„Åà„Çì„Åà„Çä„ÅÇ) smoke-free area"]},
  {kanji:"ËæõÂè£",meaning:"Spicy / Dry",hiragana:"„Åã„Çâ„Åè„Å°",category:"Restaurant",examples:["ËæõÂè£ („Åã„Çâ„Åè„Å°) spicy or dry (sake)","ËæõÂè£„ÉØ„Ç§„É≥ („Åã„Çâ„Åè„Å°„Çè„ÅÑ„Çì) dry wine","ËæõÂè£„Ç´„É¨„Éº („Åã„Çâ„Åè„Å°„Åã„Çå„Éº) spicy curry"]},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const STORAGE_KEY = 'food_kanji_v1';
function loadProgress() {
  try { const r = localStorage.getItem(STORAGE_KEY); if (r) return JSON.parse(r); } catch(e){}
  return { ratings: {}, sessions: 0 };
}
function saveProgress() {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(prog)); } catch(e){}
}
let prog = loadProgress();
prog.sessions = (prog.sessions || 0) + 1;
if (!prog.ratings) prog.ratings = {};
saveProgress();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CATEGORIES = [...new Set(KANJI.map(k => k.category))];
const SRS = {1:1, 2:2, 3:3, 4:6, 5:12};

function shuffle(a) {
  const b = [...a];
  for (let i = b.length-1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i+1));
    [b[i],b[j]] = [b[j],b[i]];
  }
  return b;
}
function getRating(kanji) { return prog.ratings[kanji]?.r || 0; }
function isDue(kanji) {
  const d = prog.ratings[kanji];
  if (!d) return true;
  return prog.sessions >= (d.nextAt || 0);
}
function setRating(kanji, r) {
  prog.ratings[kanji] = { r, nextAt: prog.sessions + SRS[r] };
}
const RATING_NAMES = ['Not studied','Not at all','Seen it','Almost','Know it','Expert ‚≠ê'];
const RATING_COLORS = ['var(--muted)','#E06055','#D4843A','#C8B040','#50B870','#6090E0'];
const BOWL_EMOJI = ['üéâ','üç±','üçú','üç£','ü•¢','üèÜ'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGE ROUTING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  window.scrollTo(0,0);
  if (id === 'home') renderHome();
  if (id === 'browse') renderBrowse();
}

function navTo(id) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('nav-'+id)?.classList.add('active');
  showPage(id);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HOME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let selectedCat = 'all';

function renderHome() {
  const total = KANJI.length;
  const studied = KANJI.filter(k => getRating(k.kanji) > 0).length;
  const known = KANJI.filter(k => getRating(k.kanji) >= 4).length;
  document.getElementById('stat-studied').textContent = studied;
  document.getElementById('stat-known').textContent = known;
  document.getElementById('stat-total').textContent = total;

  // Build category pills
  const row = document.getElementById('cat-row');
  row.innerHTML = `<button class="cat-pill ${selectedCat==='all'?'active':''}" data-cat="all" onclick="selectCat(this,'all')">All (${total})</button>`;
  CATEGORIES.forEach(cat => {
    const count = KANJI.filter(k => k.category === cat).length;
    const active = selectedCat === cat ? 'active' : '';
    row.innerHTML += `<button class="cat-pill ${active}" data-cat="${cat}" onclick="selectCat(this,'${cat}')">${cat} (${count})</button>`;
  });

  // Update card count max
  const poolSize = selectedCat === 'all' ? total : KANJI.filter(k => k.category === selectedCat).length;
  document.getElementById('card-count').max = poolSize;
}

function selectCat(btn, cat) {
  selectedCat = cat;
  document.querySelectorAll('.cat-pill').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  const poolSize = cat === 'all' ? KANJI.length : KANJI.filter(k => k.category === cat).length;
  document.getElementById('card-count').max = poolSize;
  document.getElementById('card-count').value = Math.min(parseInt(document.getElementById('card-count').value), poolSize);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FLASHCARDS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let deck = [], deckIdx = 0, revealed = false, missedCards = [];
let lastDeck = [];

function buildDeck(weakOnly) {
  let pool = selectedCat === 'all' ? KANJI : KANJI.filter(k => k.category === selectedCat);
  if (weakOnly) pool = pool.filter(k => getRating(k.kanji) <= 3);
  const num = Math.min(parseInt(document.getElementById('card-count').value) || 10, pool.length);
  // Prioritise due cards then fill with others
  const due = shuffle(pool.filter(k => isDue(k.kanji)));
  const notDue = shuffle(pool.filter(k => !isDue(k.kanji)));
  return [...due, ...notDue].slice(0, num);
}

function startFlashcards(weakOnly=false, repeatLast=false) {
  deck = repeatLast ? shuffle([...lastDeck]) : buildDeck(weakOnly);
  if (!deck.length) { alert('No cards available for that selection!'); return; }
  lastDeck = [...deck];
  deckIdx = 0; missedCards = [];
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-flashcard').classList.add('active');
  loadCard();
}

function loadCard() {
  revealed = false;
  const k = deck[deckIdx];
  const pct = Math.round((deckIdx / deck.length) * 100);
  document.getElementById('fc-fill').style.width = pct + '%';
  document.getElementById('fc-counter').textContent = `${deckIdx+1} / ${deck.length}`;
  document.getElementById('fc-cat-tag').textContent = k.category;
  document.getElementById('fc-kanji').textContent = k.kanji;
  document.getElementById('cardWrap').classList.remove('revealed');
  document.getElementById('reveal-btn').classList.remove('hidden');
  document.getElementById('answer-btns').classList.add('hidden');
  // Pre-fill back while hidden
  document.getElementById('cb-meaning').textContent = k.meaning;
  document.getElementById('cb-reading').textContent = k.hiragana;
  document.getElementById('cb-kanji-mini').textContent = k.kanji;
  document.getElementById('cb-examples').innerHTML = k.examples.map(ex =>
    `<li><span style="flex:1">${ex}</span></li>`
  ).join('');
}

function revealCard() {
  if (revealed) return;
  revealed = true;
  document.getElementById('cardWrap').classList.add('revealed');
  document.getElementById('reveal-btn').classList.add('hidden');
  document.getElementById('answer-btns').classList.remove('hidden');
}

function rateCard(r) {
  const k = deck[deckIdx];
  setRating(k.kanji, r);
  if (r <= 3) missedCards.push(k);
  saveProgress();
  deckIdx++;
  if (deckIdx < deck.length) {
    loadCard();
  } else {
    showSummary();
  }
}

function endSession() {
  showPage('home');
  navTo('home');
}

function showSummary() {
  const known = deck.length - missedCards.length;
  const pct = Math.round(known / deck.length * 100);
  document.getElementById('sum-emoji').textContent = BOWL_EMOJI[Math.min(5, Math.floor(pct/20))];
  document.getElementById('sum-sub').textContent = `${deck.length} cards reviewed`;
  document.getElementById('sum-known').textContent = known;
  document.getElementById('sum-weak').textContent = missedCards.length;
  document.getElementById('sum-retry-sub').textContent = `${missedCards.length} card${missedCards.length!==1?'s':''} rated 1‚Äì3`;
  const retryBtn = document.getElementById('sum-retry-btn');
  retryBtn.style.opacity = missedCards.length > 0 ? '1' : '0.4';
  retryBtn.style.pointerEvents = missedCards.length > 0 ? 'auto' : 'none';
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-summary').classList.add('active');
  document.getElementById('fc-fill').style.width = '100%';
  saveProgress();
}

function retryWeak() {
  if (!missedCards.length) return;
  deck = shuffle([...missedCards]);
  lastDeck = [...deck];
  deckIdx = 0; missedCards = [];
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-flashcard').classList.add('active');
  loadCard();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BROWSE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let browseFilter = 'all';

function renderBrowse() {
  // Filter tabs
  const filterRow = document.getElementById('browse-filters');
  const allCats = ['all', ...CATEGORIES];
  filterRow.innerHTML = allCats.map(cat => {
    const label = cat === 'all' ? 'All' : cat;
    return `<button class="filter-tab ${browseFilter===cat?'active':''}" onclick="setBrowseFilter('${cat}',this)">${label}</button>`;
  }).join('');
  renderBrowseList();
}

function setBrowseFilter(cat, btn) {
  browseFilter = cat;
  document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  renderBrowseList();
}

function renderBrowseList() {
  const list = browseFilter === 'all' ? KANJI : KANJI.filter(k => k.category === browseFilter);
  const rLabels = ['New','‚ë†','‚ë°','‚ë¢','‚ë£','‚ë§'];
  const rCls = ['new','r1','r2','r3','r4','r5'];
  document.getElementById('browse-list').innerHTML = list.map((k,i) => {
    const r = getRating(k.kanji);
    return `<div class="browse-item" onclick="showDetail('${k.kanji}')">
      <div class="browse-kanji">${k.kanji}</div>
      <div class="browse-info">
        <div class="browse-meaning">${k.meaning}</div>
        <div class="browse-hira">${k.hiragana}</div>
      </div>
      <span class="browse-rating ${rCls[r]}">${rLabels[r]}</span>
    </div>`;
  }).join('');
}

function showDetail(kanji) {
  const k = KANJI.find(x => x.kanji === kanji);
  if (!k) return;
  document.getElementById('det-kanji').textContent = k.kanji;
  document.getElementById('det-meaning').textContent = k.meaning;
  document.getElementById('det-reading').textContent = k.hiragana;
  document.getElementById('det-cat').textContent = k.category;
  document.getElementById('det-examples').innerHTML = k.examples.map(ex =>
    `<li>${ex}</li>`
  ).join('');
  const r = getRating(k.kanji);
  const rv = document.getElementById('det-rating');
  rv.textContent = RATING_NAMES[r];
  rv.style.color = RATING_COLORS[r];
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-detail').classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
renderHome();
</script>
</body>
</html>
